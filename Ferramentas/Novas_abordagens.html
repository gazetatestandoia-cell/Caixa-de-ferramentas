<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Pautas Jornalísticas com IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-active {
            border-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        .tab-disabled {
            color: #9ca3af;
            cursor: not-allowed;
            border-color: transparent;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-3xl bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
        
        <!-- Cabeçalho -->
        <div class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Novas abordagens</h1>
            <p class="text-gray-600 mt-2">Como uma reportagem ou temática pode ser desdobrada.</p>
        </div>

        <!-- Seleção de Input: URL ou Tema -->
        <div id="input-section">
            <div class="flex border-b border-gray-200">
                <button id="tab-url" class="py-3 px-6 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:border-gray-300 focus:outline-none tab-active">
                    Analisar por Link
                </button>
                <button id="tab-tema" class="py-3 px-6 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:border-gray-300 focus:outline-none">
                    Analisar por Tema
                </button>
            </div>

            <!-- Formulário de Input -->
            <div id="input-container" class="mt-6">
                <div id="input-url-container">
                    <label for="news-url" class="block text-sm font-medium text-gray-700 mb-2">Cole o link da reportagem:</label>
                    <input type="url" id="news-url" placeholder="https://exemplo.com/noticia..." class="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                </div>
                <div id="input-tema-container" class="hidden">
                    <label for="news-topic" class="block text-sm font-medium text-gray-700 mb-2">Digite o tema da reportagem:</label>
                    <textarea id="news-topic" rows="3" placeholder="Ex: Inteligência artificial na medicina, crise hídrica no Brasil..." class="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"></textarea>
                </div>
                
                <button id="analyze-btn" class="w-full mt-6 bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300 ease-in-out flex items-center justify-center disabled:bg-blue-300">
                    <span id="btn-text">Analisar e Gerar Sugestões</span>
                    <svg id="btn-loader" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Abas de Resultado -->
        <div id="results-tabs" class="mt-10 hidden">
            <div class="flex border-b border-gray-200">
                <button id="tab-suggestions" class="py-3 px-6 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:border-gray-300 focus:outline-none">
                    Novas Abordagens
                </button>
                <button id="tab-related" class="py-3 px-6 text-sm font-medium text-gray-500 border-b-2 border-transparent hover:border-gray-300 focus:outline-none">
                    Em Torno Desse Assunto
                </button>
            </div>
        </div>

        <!-- Seção de Resultados - Novas Abordagens -->
        <div id="results-container" class="mt-6 hidden">
             <div id="suggestions" class="space-y-6">
                <!-- As sugestões serão inseridas aqui -->
             </div>
        </div>

        <!-- Seção de Resultados - Em Torno Desse Assunto -->
        <div id="related-topics-container" class="mt-6 hidden">
            <div id="related-topics-loader" class="flex justify-center items-center py-8">
                 <svg class="animate-spin h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>
             <div id="related-topics" class="space-y-3">
                <!-- Os tópicos relacionados serão inseridos aqui -->
             </div>
        </div>

        <!-- Seção de Erro -->
        <div id="error-container" class="mt-6 hidden">
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert">
                <strong class="font-bold">Ocorreu um erro!</strong>
                <span class="block sm:inline" id="error-message"></span>
            </div>
        </div>
    </div>

    <script>
        // --- Gerenciamento da UI ---
        const tabUrl = document.getElementById('tab-url');
        const tabTema = document.getElementById('tab-tema');
        const inputUrlContainer = document.getElementById('input-url-container');
        const inputTemaContainer = document.getElementById('input-tema-container');
        const analyzeBtn = document.getElementById('analyze-btn');
        const btnText = document.getElementById('btn-text');
        const btnLoader = document.getElementById('btn-loader');
        const newsUrlInput = document.getElementById('news-url');
        const newsTopicInput = document.getElementById('news-topic');
        
        const resultsTabs = document.getElementById('results-tabs');
        const tabSuggestions = document.getElementById('tab-suggestions');
        const tabRelated = document.getElementById('tab-related');

        const resultsContainer = document.getElementById('results-container');
        const suggestionsContainer = document.getElementById('suggestions');

        const relatedTopicsContainer = document.getElementById('related-topics-container');
        const relatedTopics = document.getElementById('related-topics');
        const relatedTopicsLoader = document.getElementById('related-topics-loader');

        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');

        let activeInputTab = 'url';
        let lastAnalysisInput = { type: '', value: '' };

        // --- Chave de API do Usuário ---
        // IMPORTANTE: Para usar este código fora do ambiente Gemini, você precisa
        // de sua própria chave de API do Google AI.
        // 1. Obtenha sua chave em: https://aistudio.google.com/app/apikey
        // 2. Cole sua chave abaixo, substituindo "SUA_CHAVE_API_VAI_AQUI".
        const USER_API_KEY = "AIzaSyBS4FaQ1okqftnyK37UQdyuG308FRr0V4Y";

        // --- Event Listeners ---
        tabUrl.addEventListener('click', () => switchInputTab('url'));
        tabTema.addEventListener('click', () => switchInputTab('tema'));
        analyzeBtn.addEventListener('click', handleAnalysis);
        tabSuggestions.addEventListener('click', () => switchResultView('suggestions'));
        tabRelated.addEventListener('click', handleRelatedTopics);

        function switchInputTab(tabName) {
            activeInputTab = tabName;
            tabUrl.classList.toggle('tab-active', tabName === 'url');
            tabTema.classList.toggle('tab-active', tabName === 'tema');
            inputUrlContainer.classList.toggle('hidden', tabName !== 'url');
            inputTemaContainer.classList.toggle('hidden', tabName !== 'tema');
        }

        function switchResultView(viewName) {
            tabSuggestions.classList.toggle('tab-active', viewName === 'suggestions');
            tabRelated.classList.toggle('tab-active', viewName === 'related');
            resultsContainer.classList.toggle('hidden', viewName !== 'suggestions');
            relatedTopicsContainer.classList.toggle('hidden', viewName !== 'related');
        }

        // --- Chamadas à API ---
        async function callGeminiAPI(userQuery, systemPrompt) {
            if (!USER_API_KEY || USER_API_KEY === "SUA_CHAVE_API_VAI_AQUI") {
                throw new Error("Chave de API não configurada. Por favor, adicione sua chave de API do Google AI no código.");
            }
            
            const apiKey = USER_API_KEY; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let response;
            let retries = 3;
            let delay = 1000;
            while (retries > 0) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) break;
                } catch (error) { console.error("Fetch attempt failed:", error); }
                retries--;
                if (retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    delay *= 2;
                }
            }
            if (!response || !response.ok) throw new Error(`A API retornou um erro: ${response?.statusText || 'Não foi possível conectar'}`);
            
            const result = await response.json();
            const candidate = result.candidates?.[0];
            if (!candidate || !candidate.content?.parts?.[0]?.text) throw new Error("A resposta da API está incompleta ou vazia.");

            const responseText = candidate.content.parts[0].text.replaceAll('```json', '').replaceAll('```', '').trim();
            try {
                return JSON.parse(responseText);
            } catch (parseError) {
                console.error("Erro ao fazer parse do JSON:", responseText);
                throw new Error("A API retornou uma resposta em um formato inesperado. Tente novamente.");
            }
        }

        async function handleAnalysis() {
            const input = activeInputTab === 'url' ? newsUrlInput.value.trim() : newsTopicInput.value.trim();
            if (!input) {
                showError('Por favor, insira um link ou um tema para análise.');
                return;
            }
            setLoading(true);
            hideError();
            resultsTabs.classList.add('hidden');
            resultsContainer.classList.add('hidden');
            relatedTopicsContainer.classList.add('hidden');

            lastAnalysisInput = { type: activeInputTab, value: input };

            try {
                const systemPrompt = `Você é um editor de notícias digitais experiente e criativo, especialista em jornalismo orientado por audiência. Sua tarefa é analisar um tema ou o conteúdo de uma reportagem e propor novas pautas jornalísticas relevantes, baseadas nos "user needs" (necessidades do usuário).`;
                const userQuery = `Analise ${lastAnalysisInput.type === 'url' ? `o conteúdo da reportagem no link: ${lastAnalysisInput.value}` : `o seguinte tema: "${lastAnalysisInput.value}"`}. Com base na sua análise e em uma busca por tópicos em alta, gere cinco títulos para novas reportagens. Cada sugestão deve se encaixar em um dos seguintes conceitos de "user needs" (necessidades do usuário): "Atualize-me", "Eduque-me", "Dê-me perspectiva", "Mantenha-me em dia", e "Inspire-me". Para cada título, forneça a categoria do "user need" e uma breve justificativa (2-3 frases) explicando a relevância da abordagem. Formate a resposta EXATAMENTE como um JSON com a seguinte estrutura: { "sugestoes": [ { "titulo": "...", "categoria": "...", "justificativa": "..." } ] }`;
                const parsedData = await callGeminiAPI(userQuery, systemPrompt);
                
                displayResults(parsedData.sugestoes);
                resultsTabs.classList.remove('hidden');
                switchResultView('suggestions');
                relatedTopics.innerHTML = ''; // Limpa resultados anteriores da outra aba

            } catch (error) {
                console.error("Erro em handleAnalysis:", error);
                showError(error.message);
            } finally {
                setLoading(false);
            }
        }

        async function handleRelatedTopics() {
            if (tabRelated.classList.contains('tab-active')) return;
            switchResultView('related');
            
            if (relatedTopics.innerHTML !== '') return; // Já foi carregado

            relatedTopicsLoader.classList.remove('hidden');
            hideError();
            
            try {
                const systemPrompt = `Você é um editor de notícias digitais e estrategista de conteúdo, especialista em SEO e análise de tendências. Sua tarefa é analisar um tema e gerar ideias de pautas orbitais.`;
                const userQuery = `Com base na análise de ${lastAnalysisInput.type === 'url' ? `o conteúdo da reportagem no link: ${lastAnalysisInput.value}` : `o seguinte tema: "${lastAnalysisInput.value}"`}, gere uma lista de 10 ideias de assuntos que orbitam essa temática. A lista deve ser diversificada e seguir esta composição: 5 ideias (50%) baseadas em perguntas comuns que as pessoas fazem no Google sobre o assunto; 3 ideias (30%) baseadas nas palavras-chave centrais do tema/reportagem; e 2 ideias (20%) de sugestão livre, baseadas em conexões criativas ou inesperadas que você identificar. Formate a resposta EXATAMENTE como um JSON com a seguinte estrutura: { "topicos": [ {"tipo": "Pergunta Popular", "ideia": "..."}, {"tipo": "Palavra-Chave", "ideia": "..."}, {"tipo": "Sugestão Criativa", "ideia": "..."} ] }`;

                const parsedData = await callGeminiAPI(userQuery, systemPrompt);
                displayRelatedTopics(parsedData.topicos);

            } catch (error) {
                 console.error("Erro em handleRelatedTopics:", error);
                 showError("Não foi possível buscar os tópicos relacionados. Tente novamente.");
            } finally {
                relatedTopicsLoader.classList.add('hidden');
            }
        }

        // --- Funções de Display e UI Auxiliar ---
        function setLoading(isLoading) {
            analyzeBtn.disabled = isLoading;
            btnText.classList.toggle('hidden', isLoading);
            btnLoader.classList.toggle('hidden', !isLoading);
        }

        function displayResults(suggestionsList) {
            suggestionsContainer.innerHTML = '';
            if (!suggestionsList || suggestionsList.length === 0) {
                showError("Nenhuma sugestão foi gerada. Tente refinar seu tema ou usar outro link.");
                return;
            }
            suggestionsList.forEach(suggestion => {
                const card = document.createElement('div');
                card.className = 'bg-gray-50 p-5 rounded-lg border border-gray-200 transition-all hover:shadow-md';
                card.innerHTML = `
                    <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full mb-3">${suggestion.categoria || 'Geral'}</span>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">${suggestion.titulo}</h3>
                    <p class="text-gray-600 text-sm">${suggestion.justificativa}</p>
                `;
                suggestionsContainer.appendChild(card);
            });
        }

        function displayRelatedTopics(topicsList) {
            relatedTopics.innerHTML = '';
             if (!topicsList || topicsList.length === 0) {
                relatedTopics.innerHTML = `<p class="text-gray-500 text-center">Nenhum tópico relacionado encontrado.</p>`;
                return;
            }
            const list = document.createElement('ul');
            list.className = 'space-y-2 list-disc list-inside text-gray-700';
            topicsList.forEach(topic => {
                const item = document.createElement('li');
                item.className = 'p-3 bg-gray-50 rounded-md';
                
                let typeBadge = '';
                switch(topic.tipo) {
                    case 'Pergunta Popular': typeBadge = '<span class="text-xs font-medium text-green-800 bg-green-100 rounded-full px-2 py-0.5 mr-2">Busca</span>'; break;
                    case 'Palavra-Chave': typeBadge = '<span class="text-xs font-medium text-purple-800 bg-purple-100 rounded-full px-2 py-0.5 mr-2">Keyword</span>'; break;
                    case 'Sugestão Criativa': typeBadge = '<span class="text-xs font-medium text-yellow-800 bg-yellow-100 rounded-full px-2 py-0.5 mr-2">Criativo</span>'; break;
                }

                item.innerHTML = `${typeBadge} ${topic.ideia}`;
                list.appendChild(item);
            });
            relatedTopics.appendChild(list);
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorContainer.classList.remove('hidden');
        }

        function hideError() {
            errorContainer.classList.add('hidden');
        }
    </script>
</body>
</html>


