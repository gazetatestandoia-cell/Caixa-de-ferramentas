<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revisor de Textos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border: 4px solid #4a5568;
            border-top: 4px solid #6366f1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #results-container h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #4a5568;
        }
         #results-container h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        #results-container strong {
            color: #c7d2fe;
        }
        #results-container ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }
        #results-container li {
            margin-bottom: 0.75rem;
        }
        #notification {
            transition: opacity 0.5s, transform 0.5s;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <div class="container mx-auto max-w-4xl px-4 py-8 md:py-12">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">Revisor de Textos</h1>
            <p class="text-gray-400">Cole seu texto ou link para receber uma revisão detalhada</p>
        </header>

        <main>
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Tipo de Revisão:</label>
                    <div class="flex space-x-2 rounded-lg bg-gray-900 p-1">
                        <button id="simple-review-btn" data-review-type="simple" class="review-type-btn w-full text-center px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 bg-indigo-600 text-white">
                            Revisão Simples
                        </button>
                        <button id="seo-review-btn" data-review-type="seo" class="review-type-btn w-full text-center px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 bg-gray-700 text-gray-300 hover:bg-gray-600">
                            Revisão com SEO
                        </button>
                    </div>
                </div>
                <label for="text-input" class="block text-sm font-medium text-gray-300 mb-2">Seu texto:</label>
                <textarea id="text-input" rows="10" class="w-full p-3 bg-gray-900 border border-gray-700 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" placeholder="Cole o texto a ser revisado aqui..."></textarea>
                
                <div class="mt-6 flex justify-center">
                    <button id="review-button" class="w-full md:w-auto bg-indigo-600 text-white font-semibold py-3 px-8 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-indigo-500 transition duration-200 disabled:bg-indigo-400 disabled:cursor-not-allowed">
                        Revisar Texto
                    </button>
                </div>
                <p class="text-xs text-gray-500 text-center mt-4">Este sistema é assistido por Inteligência Artificial. Por isso, você <strong class="text-gray-400">DEVE</strong> conferir e validar todas as respostas que receber.</p>
            </div>

            <div id="output-container" class="mt-10 bg-gray-800 p-6 rounded-lg shadow-lg hidden">
                <div id="loading-indicator" class="flex flex-col items-center justify-center py-10 hidden">
                    <div class="loader"></div>
                    <p class="mt-4 text-gray-400">A analisar o texto... Isto pode levar alguns segundos.</p>
                </div>
                <div id="error-message" class="text-center text-red-400 p-4 bg-red-900/50 rounded-md hidden"></div>
                <div id="results-container" class="prose prose-invert max-w-none text-gray-300">
                    <!-- O conteúdo gerado pela IA será inserido aqui -->
                </div>
            </div>
        </main>
        
        <footer class="text-center mt-12 text-gray-500 text-sm">
            <p>&copy; 2025 - Ferramenta de Revisão com IA Generativa</p>
        </footer>
    </div>
    
    <!-- Notificação de "Copiado!" -->
    <div id="notification" class="fixed bottom-5 right-5 bg-slate-200 text-slate-800 font-semibold py-3 px-6 rounded-lg shadow-xl opacity-0 transform translate-y-10">
        Texto copiado!
    </div>

    <script>
        const textInput = document.getElementById('text-input');
        const reviewButton = document.getElementById('review-button');
        const outputContainer = document.getElementById('output-container');
        const loadingIndicator = document.getElementById('loading-indicator');
        const errorMessage = document.getElementById('error-message');
        const resultsContainer = document.getElementById('results-container');
        const simpleReviewBtn = document.getElementById('simple-review-btn');
        const seoReviewBtn = document.getElementById('seo-review-btn');
        const notification = document.getElementById('notification');

        let selectedReviewType = 'simple';

        const simpleSystemPrompt = `Você é um revisor de textos jornalísticos. Quando eu enviar um texto, revise-o seguindo estritamente as normas da língua portuguesa, preservando a intenção e o estilo do autor. **NÃO ALTERE** o texto original do autor, exceto para corrigir erros. **Altere apenas** erros de: ortografia e acentuação (incluindo Acordo Ortográfico vigente), gramática, concordância verbal e nominal, regência, pontuação (incluindo uso da crase), morfologia, léxico (uso inadequado de palavra), sintaxe e semântica que comprometam clareza. Mantenha tom jornalístico, conversacional e informativo; público-alvo: ensino fundamental a médio.

Saída exigida — entregue nesta ordem:

1.  **Relatório detalhado de erros e correções**: para cada correção, informe:
    - trecho original (entre aspas);
    - correção proposta (entre aspas);
    - categoria do erro (ex.: ortografia, concordância verbal, regência, pontuação, léxico, sintaxe);
    - explicação curta (1–2 frases) do porquê da correção e, quando aplicável, referência normativa sucinta (ex.: "Acordo Ortográfico"; "regência do verbo X").
    - se a alteração for opcional (estilística), marque como **Sugestão (opcional)**; caso contrário, marque **Correção obrigatória**.

2.  **Texto original | Texto corrigido** — apresentação lado a lado em duas colunas:
    - coluna esquerda: **Texto original** (sem modificações);
    - coluna direita: **Texto corrigido** — aplique todas as correções mandatórias; **DESTAQUE EM NEGRITO APENAS** as palavras/trechos pontuais que foram alterados (não negrite palavras que permaneceram iguais). Se a correção foi apenas de pontuação, destaque apenas o sinal de pontuação alterado em negrito.
    - mantenha quebras de parágrafo e ordem do conteúdo igual ao original.

3.  **Versão final do texto** — o texto corrigido completo, já com todas as correções aplicadas, pronto para publicação.

Regras operacionais e restrições:
- Não acrescente nem remova informação factual. Não reescreva parágrafos por estilo; faça apenas as correções necessárias para norma/clareza.
- Se houver ambiguidade que só pode ser resolvida mudando o sentido, **não altere**; marque no relatório como **Ambiguidade a esclarecer** e proponha uma alternativa sinalizada como **Sugestão (opcional)**.
- Ao corrigir crase, pontuação ou concordância, explique a regra em 1 frase simples voltada ao leitor leigo.
- Use linguagem do relatório acessível a leitores do ensino fundamental/médio.
- Ao final, inclua um pequeno resumo (2–3 linhas) informando o número total de correções por categoria (ex.: 4 ortografia; 2 crase; 1 concordância).`;

        const seoSystemPrompt = `Você é um revisor e editor de textos jornalísticos especializados em SEO (Search Engine Optimization). Quando eu enviar um texto, revise-o seguindo rigorosamente as normas da língua portuguesa, **sem alterar o estilo ou a intenção do autor**, mas aplicando técnicas de SEO para aumentar sua visibilidade e leitura online.

Siga as instruções abaixo:

1. **Correções linguísticas obrigatórias**
   - Corrija apenas erros de ortografia, acentuação, gramática, concordância, regência, pontuação, morfologia, léxico e sintaxe.
   - Não reescreva parágrafos inteiros. Mantenha o estilo do autor.
   - Garanta clareza e fluidez, adequando o texto para leitura digital (frases curtas, linguagem direta e natural).

2. **Ajustes e otimizações de SEO**
   - Identifique a **palavra-chave principal** (ou expressões relacionadas) e aplique-a naturalmente:
     - No **título principal** (H1);
     - Nos **intertítulos** (H2, H3);
     - No **primeiro parágrafo** e, se possível, no último.
   - Garanta que o texto mantenha uma **densidade de palavra-chave** entre 0,8% e 2% sem parecer artificial.
   - Sugira **sinônimos e variações semânticas** (palavras LSI — Latent Semantic Indexing) para enriquecer o campo lexical.
   - Otimize **meta descrição** (máx. 155 caracteres) e **título SEO** (máx. 60 caracteres), se o texto tiver caráter noticioso, de blog ou informativo.
   - Aplique **boas práticas de escaneabilidade**:
     - Parágrafos curtos (máx. 3 linhas);
     - Uso pontual de conectivos para transição;
     - Destaques estratégicos (negrito) para palavras-chave e termos relevantes.
   - Mantenha tom conversacional, acessível a leitores de ensino fundamental e médio.

3. **Saída exigida**
   - **Relatório detalhado de correções e ajustes de SEO**:
     - a) Erros linguísticos corrigidos (original → corrigido → categoria → explicação);
     - b) Melhorias de SEO aplicadas (ex.: ajuste de título, inclusão de palavra-chave, meta descrição sugerida, intertítulo otimizado).
   - **Texto original | Texto otimizado e revisado** (duas colunas lado a lado):
     - Coluna esquerda: Texto original;
     - Coluna direita: Texto revisado/otimizado, com **alterações destacadas em negrito**.
   - **Versão final do texto pronta para publicação**, com todas as correções aplicadas.
   - **Resumo numérico**: total de correções linguísticas e ajustes de SEO.
   - **Observações adicionais** (sugestões opcionais de título, slug, tags e meta descrição).

Restrições:
- Não usar jargões técnicos excessivos.
- Não repetir artificialmente a palavra-chave.
- Não inserir links falsos.
- Não alterar fatos nem criar conteúdo novo.
- Se houver ambiguidade sem solução semântica, marque no relatório como **Ambiguidade a esclarecer**.

Formato de saída obrigatório:
1️⃣ Relatório (erros e melhorias); 
2️⃣ Tabela lado a lado (original × otimizado); 
3️⃣ Versão final do texto; 
4️⃣ Resumo numérico; 
5️⃣ Observações SEO.`;

        simpleReviewBtn.addEventListener('click', () => {
            selectedReviewType = 'simple';
            updateButtonStyles();
        });

        seoReviewBtn.addEventListener('click', () => {
            selectedReviewType = 'seo';
            updateButtonStyles();
        });

        function updateButtonStyles() {
            if (selectedReviewType === 'simple') {
                simpleReviewBtn.classList.add('bg-indigo-600', 'text-white');
                simpleReviewBtn.classList.remove('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                seoReviewBtn.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                seoReviewBtn.classList.remove('bg-indigo-600', 'text-white');
            } else {
                seoReviewBtn.classList.add('bg-indigo-600', 'text-white');
                seoReviewBtn.classList.remove('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                simpleReviewBtn.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                simpleReviewBtn.classList.remove('bg-indigo-600', 'text-white');
            }
        }

        reviewButton.addEventListener('click', handleReviewRequest);

        async function handleReviewRequest() {
            const userText = textInput.value.trim();

            if (!userText) {
                showError("Por favor, insira um texto para ser revisado.");
                return;
            }
            
            reviewButton.disabled = true;
            reviewButton.textContent = 'A revisar...';
            outputContainer.classList.remove('hidden');
            loadingIndicator.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            resultsContainer.innerHTML = '';

            const currentPrompt = selectedReviewType === 'simple' ? simpleSystemPrompt : seoSystemPrompt;

            try {
                const resultText = await callBackendAPI(userText, currentPrompt);
                displayResults(resultText);
            } catch (error) {
                console.error("Erro ao chamar a API:", error);
                showError(`Ocorreu um erro: ${error.message}`);
            } finally {
                reviewButton.disabled = false;
                reviewButton.textContent = 'Revisar Texto';
                loadingIndicator.classList.add('hidden');
            }
        }

        async function callBackendAPI(userQuery, systemPrompt) {
            const apiUrl = '/api/Revisor'; // Endpoint da nossa função serverless

            const payload = {
                userQuery,
                systemPrompt
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.error || `Erro HTTP: ${response.status}`);
            }

            const candidate = result.candidates?.[0];

            if (candidate && candidate.content?.parts?.[0]?.text) {
                return candidate.content.parts[0].text;
            } else {
                if (candidate && candidate.finishReason === 'SAFETY') {
                    throw new Error("A resposta foi bloqueada por motivos de segurança. Tente reformular o texto.");
                }
                throw new Error("Resposta da API inválida ou sem conteúdo.");
            }
        }
        
        function displayResults(rawText) {
            let htmlContent = rawText
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>')
                .replace(/1️⃣/g, '<h2>1.')
                .replace(/2️⃣/g, '<h2>2.')
                .replace(/3️⃣/g, '<h2>3.')
                .replace(/4️⃣/g, '<h2>4.')
                .replace(/5️⃣/g, '<h2>5.');
            
            const titles = [
                'Relatório (erros e melhorias)', 'Relatório (Erros e Melhorias)',
                'Tabela lado a lado (original × otimizado)', 'Tabela Lado a Lado (Original vs. Otimizado)',
                'Versão final do texto', 'Versão Final do Texto',
                'Resumo numérico', 'Resumo Numérico',
                'Observações SEO', 'Observações SEO',
                'Relatório detalhado de erros e correções', 'Relatório Detalhado de Erros e Correções',
                'Texto original | Texto corrigido', 'Comparativo Lado a Lado',
                'Texto original | Texto otimizado e revisado', 'Comparativo Lado a Lado'
            ];
            
            for (let i = 0; i < titles.length; i += 2) {
                const regex = new RegExp(`(<strong>)?${titles[i]}(<\/strong>)?`, 'g');
                htmlContent = htmlContent.replace(regex, `${titles[i+1]}</h2>`);
            }
            htmlContent = htmlContent.replace(/<h2>(\d\.)/g, '<h2>$1');

            let finalVersionStartIndex = htmlContent.indexOf('<h2>3. Versão Final do Texto</h2>');
            if (finalVersionStartIndex !== -1) {
                const finalVersionHeader = '<h2>3. Versão Final do Texto</h2>';
                let nextSectionIndex = htmlContent.indexOf('<h2>', finalVersionStartIndex + 10);
                if (nextSectionIndex === -1) {
                    nextSectionIndex = htmlContent.length;
                }
                const finalVersionContent = htmlContent.substring(finalVersionStartIndex + finalVersionHeader.length, nextSectionIndex).trim();

                const newFinalSection = `
                    <div class="flex justify-between items-center mt-6">
                        <h2>3. Versão Final do Texto</h2>
                        <button id="copy-final-text-btn" title="Copiar Versão Final" class="text-gray-400 hover:text-indigo-400 transition-colors p-2 rounded-md -mr-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z"></path><path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h6a2 2 0 00-2-2H5z"></path></svg>
                        </button>
                    </div>
                    <div id="final-text-content" class="mt-2 border border-gray-700 p-4 rounded-md bg-gray-900">${finalVersionContent}</div>
                `;
                htmlContent = htmlContent.substring(0, finalVersionStartIndex) + newFinalSection + htmlContent.substring(nextSectionIndex);
            }

            let comparisonStartIndex = htmlContent.indexOf('<h2>2. Comparativo Lado a Lado</h2>');
            if (comparisonStartIndex !== -1) {
                const comparisonHeader = '<h2>2. Comparativo Lado a Lado</h2>';
                const nextHeaderIndex = htmlContent.indexOf('<div class="flex justify-between items-center mt-6">', comparisonStartIndex);
                const comparisonContent = htmlContent.substring(comparisonStartIndex + comparisonHeader.length, nextHeaderIndex).trim();

                const originalMarker = '<strong>Texto original</strong><br>';
                const correctedMarker = '<strong>Texto corrigido</strong><br>';
                const seoMarker = '<strong>Texto otimizado e revisado</strong><br>';

                let originalText = '';
                let correctedText = '';
                let correctedTitle = selectedReviewType === 'simple' ? 'Texto Corrigido' : 'Texto Otimizado';

                let correctedStartIndex = comparisonContent.indexOf(correctedMarker);
                if (correctedStartIndex === -1) correctedStartIndex = comparisonContent.indexOf(seoMarker);

                if (correctedStartIndex !== -1) {
                    originalText = comparisonContent.substring(originalMarker.length, correctedStartIndex).trim();
                    correctedText = comparisonContent.substring(correctedStartIndex + (comparisonContent.includes(correctedMarker) ? correctedMarker.length : seoMarker.length)).trim();
                }

                const tableHTML = `
                    <h2>2. Comparativo Lado a Lado</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                        <div class="border border-gray-700 p-4 rounded-md">
                            <h3 class="text-white mb-3">Texto Original</h3>
                            <p>${originalText}</p>
                        </div>
                        <div class="border border-gray-700 p-4 rounded-md">
                            <h3 class="text-white mb-3">${correctedTitle}</h3>
                            <p>${correctedText}</p>
                        </div>
                    </div>
                `;
                htmlContent = htmlContent.substring(0, comparisonStartIndex) + tableHTML + htmlContent.substring(nextHeaderIndex);
            }
            
            resultsContainer.innerHTML = htmlContent;

            const copyFinalBtn = document.getElementById('copy-final-text-btn');
            if (copyFinalBtn) {
                copyFinalBtn.addEventListener('click', () => {
                    const textToCopy = document.getElementById('final-text-content').innerText;
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showNotification('Versão final copiada!');
                    });
                });
            }
        }
        
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.remove('opacity-0', 'translate-y-10');
            notification.classList.add('opacity-100', 'translate-y-0');
            setTimeout(() => {
                notification.classList.remove('opacity-100', 'translate-y-0');
                notification.classList.add('opacity-0', 'translate-y-10');
            }, 2500);
        }

        function showError(message) {
            outputContainer.classList.remove('hidden');
            errorMessage.classList.remove('hidden');
            errorMessage.textContent = message;
            resultsContainer.innerHTML = '';
            loadingIndicator.classList.add('hidden');
        }

    </script>

</body>
</html>

