<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revisando</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilo para a animação do spinner de carregamento */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Estilos para o conteúdo gerado, tratando a formatação markdown-like */
        #results-container h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #4a5568;
        }
         #results-container h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        #results-container strong {
            color: #c7d2fe;
        }
        #results-container ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }
        #results-container li {
            margin-bottom: 0.75rem;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <div class="container mx-auto max-w-4xl px-4 py-8 md:py-12">
        <!-- Cabeçalho -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">Revisor de Textos com IA</h1>
            <p class="text-gray-400">Cole seu texto abaixo para receber uma revisão detalhada, seguindo as normas da língua portuguesa.</p>
        </header>

        <!-- Área de Input -->
        <main>
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Tipo de Revisão:</label>
                    <div class="flex space-x-2 rounded-lg bg-gray-900 p-1">
                        <button id="simple-review-btn" data-review-type="simple" class="review-type-btn w-full text-center px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 bg-indigo-600 text-white">
                            Revisão Simples
                        </button>
                        <button id="seo-review-btn" data-review-type="seo" class="review-type-btn w-full text-center px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-200 bg-gray-700 text-gray-300 hover:bg-gray-600">
                            Revisão com SEO
                        </button>
                    </div>
                </div>
                <label for="text-input" class="block text-sm font-medium text-gray-300 mb-2">Seu texto:</label>
                <textarea id="text-input" rows="10" class="w-full p-3 bg-gray-900 border border-gray-700 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" placeholder="Cole o texto a ser revisado aqui..."></textarea>
                
                <div class="mt-6 flex justify-center">
                    <button id="review-button" class="w-full md:w-auto bg-indigo-600 text-white font-semibold py-3 px-8 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-indigo-500 transition duration-200 disabled:bg-indigo-400 disabled:cursor-not-allowed">
                        Revisar Texto
                    </button>
                </div>
            </div>

            <!-- Área de Resultados -->
            <div id="output-container" class="mt-10 bg-gray-800 p-6 rounded-lg shadow-lg hidden">
                <!-- Estado de Carregamento -->
                <div id="loading-indicator" class="flex flex-col items-center justify-center py-10 hidden">
                    <div class="loader"></div>
                    <p class="mt-4 text-gray-400">Analisando o texto... Isso pode levar alguns segundos.</p>
                </div>

                <!-- Mensagem de Erro -->
                <div id="error-message" class="text-center text-red-400 p-4 bg-red-900/50 rounded-md hidden"></div>
                
                <!-- Conteúdo dos Resultados -->
                <div id="results-container" class="prose prose-invert max-w-none text-gray-300">
                    <!-- O conteúdo gerado pela IA será inserido aqui -->
                </div>
            </div>
        </main>
        
        <!-- Rodapé -->
        <footer class="text-center mt-12 text-gray-500 text-sm">
            <p>&copy; 2025 - Ferramenta de Revisão com IA Generativa</p>
        </footer>
    </div>

    <script>
        // Seleciona os elementos do DOM
        const textInput = document.getElementById('text-input');
        const reviewButton = document.getElementById('review-button');
        const outputContainer = document.getElementById('output-container');
        const loadingIndicator = document.getElementById('loading-indicator');
        const errorMessage = document.getElementById('error-message');
        const resultsContainer = document.getElementById('results-container');
        const simpleReviewBtn = document.getElementById('simple-review-btn');
        const seoReviewBtn = document.getElementById('seo-review-btn');

        // =======================================================================
        //  PARA USO LOCAL: ONDE INSERIR SUA CHAVE DE API (OBRIGATÓRIO)
        //  Você deve colar sua chave de API do Google AI Studio aqui para
        //  que a aplicação funcione.
        //  Exemplo: const API_KEY = "SUA_CHAVE_AQUI";
        // =======================================================================
        const API_KEY = "AIzaSyBS4FaQ1okqftnyK37UQdyuG308FRr0V4Y";

        let selectedReviewType = 'simple'; // 'simple' or 'seo'

        // O prompt detalhado fornecido pelo usuário
        const simpleSystemPrompt = `Você é um revisor de textos jornalísticos. Quando eu enviar um texto, revise-o seguindo estritamente as normas da língua portuguesa, preservando a intenção e o estilo do autor. **NÃO ALTERE** o texto original do autor, exceto para corrigir erros. **Altere apenas** erros de: ortografia e acentuação (incluindo Acordo Ortográfico vigente), gramática, concordância verbal e nominal, regência, pontuação (incluindo uso da crase), morfologia, léxico (uso inadequado de palavra), sintaxe e semântica que comprometam clareza. Mantenha tom jornalístico, conversacional e informativo; público-alvo: ensino fundamental a médio.

Saída exigida — entregue nesta ordem:

1.  **Relatório detalhado de erros e correções**: para cada correção, informe:
    - trecho original (entre aspas);
    - correção proposta (entre aspas);
    - categoria do erro (ex.: ortografia, concordância verbal, regência, pontuação, léxico, sintaxe);
    - explicação curta (1–2 frases) do porquê da correção e, quando aplicável, referência normativa sucinta (ex.: "Acordo Ortográfico"; "regência do verbo X").
    - se a alteração for opcional (estilística), marque como **Sugestão (opcional)**; caso contrário, marque **Correção obrigatória**.

2.  **Texto original | Texto corrigido** — apresentação lado a lado em duas colunas:
    - coluna esquerda: **Texto original** (sem modificações);
    - coluna direita: **Texto corrigido** — aplique todas as correções mandatórias; **DESTAQUE EM NEGRITO APENAS** as palavras/trechos pontuais que foram alterados (não negrite palavras que permaneceram iguais). Se a correção foi apenas de pontuação, destaque apenas o sinal de pontuação alterado em negrito.
    - mantenha quebras de parágrafo e ordem do conteúdo igual ao original.

3.  **Versão final do texto** — o texto corrigido completo, já com todas as correções aplicadas, pronto para publicação.

Regras operacionais e restrições:
- Não acrescente nem remova informação factual. Não reescreva parágrafos por estilo; faça apenas as correções necessárias para norma/clareza.
- Se houver ambiguidade que só pode ser resolvida mudando o sentido, **não altere**; marque no relatório como **Ambiguidade a esclarecer** e proponha uma alternativa sinalizada como **Sugestão (opcional)**.
- Ao corrigir crase, pontuação ou concordância, explique a regra em 1 frase simples voltada ao leitor leigo.
- Use linguagem do relatório acessível a leitores do ensino fundamental/médio.
- Ao final, inclua um pequeno resumo (2–3 linhas) informando o número total de correções por categoria (ex.: 4 ortografia; 2 crase; 1 concordância).`;

        const seoSystemPrompt = `Você é um revisor e editor de textos jornalísticos especializados em SEO (Search Engine Optimization). Quando eu enviar um texto, revise-o seguindo rigorosamente as normas da língua portuguesa, **sem alterar o estilo ou a intenção do autor**, mas aplicando técnicas de SEO para aumentar sua visibilidade e leitura online.

Siga as instruções abaixo:

1. **Correções linguísticas obrigatórias**
   - Corrija apenas erros de ortografia, acentuação, gramática, concordância, regência, pontuação, morfologia, léxico e sintaxe.
   - Não reescreva parágrafos inteiros. Mantenha o estilo do autor.
   - Garanta clareza e fluidez, adequando o texto para leitura digital (frases curtas, linguagem direta e natural).

2. **Ajustes e otimizações de SEO**
   - Identifique a **palavra-chave principal** (ou expressões relacionadas) e aplique-a naturalmente:
     - No **título principal** (H1);
     - Nos **intertítulos** (H2, H3);
     - No **primeiro parágrafo** e, se possível, no último.
   - Garanta que o texto mantenha uma **densidade de palavra-chave** entre 0,8% e 2% sem parecer artificial.
   - Sugira **sinônimos e variações semânticas** (palavras LSI — Latent Semantic Indexing) para enriquecer o campo lexical.
   - Otimize **meta descrição** (máx. 155 caracteres) e **título SEO** (máx. 60 caracteres), se o texto tiver caráter noticioso, de blog ou informativo.
   - Aplique **boas práticas de escaneabilidade**:
     - Parágrafos curtos (máx. 3 linhas);
     - Uso pontual de conectivos para transição;
     - Destaques estratégicos (negrito) para palavras-chave e termos relevantes.
   - Mantenha tom conversacional, acessível a leitores de ensino fundamental e médio.

3. **Saída exigida**
   - **Relatório detalhado de correções e ajustes de SEO**:
     - a) Erros linguísticos corrigidos (original → corrigido → categoria → explicação);
     - b) Melhorias de SEO aplicadas (ex.: ajuste de título, inclusão de palavra-chave, meta descrição sugerida, intertítulo otimizado).
   - **Texto original | Texto otimizado e revisado** (duas colunas lado a lado):
     - Coluna esquerda: Texto original;
     - Coluna direita: Texto revisado/otimizado, com **alterações destacadas em negrito**.
   - **Versão final do texto pronta para publicação**, com todas as correções aplicadas.
   - **Resumo numérico**: total de correções linguísticas e ajustes de SEO.
   - **Observações adicionais** (sugestões opcionais de título, slug, tags e meta descrição).

Restrições:
- Não usar jargões técnicos excessivos.
- Não repetir artificialmente a palavra-chave.
- Não inserir links falsos.
- Não alterar fatos nem criar conteúdo novo.
- Se houver ambiguidade sem solução semântica, marque no relatório como **Ambiguidade a esclarecer**.

Formato de saída obrigatório:
1️⃣ Relatório (erros e melhorias); 
2️⃣ Tabela lado a lado (original × otimizado); 
3️⃣ Versão final do texto; 
4️⃣ Resumo numérico; 
5️⃣ Observações SEO.`;

        simpleReviewBtn.addEventListener('click', () => {
            selectedReviewType = 'simple';
            updateButtonStyles();
        });

        seoReviewBtn.addEventListener('click', () => {
            selectedReviewType = 'seo';
            updateButtonStyles();
        });

        function updateButtonStyles() {
            if (selectedReviewType === 'simple') {
                simpleReviewBtn.classList.add('bg-indigo-600', 'text-white');
                simpleReviewBtn.classList.remove('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                seoReviewBtn.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                seoReviewBtn.classList.remove('bg-indigo-600', 'text-white');
            } else {
                seoReviewBtn.classList.add('bg-indigo-600', 'text-white');
                seoReviewBtn.classList.remove('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                simpleReviewBtn.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                simpleReviewBtn.classList.remove('bg-indigo-600', 'text-white');
            }
        }

        // Adiciona o evento de clique ao botão
        reviewButton.addEventListener('click', handleReviewRequest);

        async function handleReviewRequest() {
            const userText = textInput.value.trim();

            if (!API_KEY) {
                showError("Chave de API não configurada no código. Edite o arquivo HTML para adicioná-la.");
                return;
            }

            if (!userText) {
                showError("Por favor, insira um texto para ser revisado.");
                return;
            }
            
            // Prepara a UI para a chamada da API
            reviewButton.disabled = true;
            outputContainer.classList.remove('hidden');
            loadingIndicator.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            resultsContainer.innerHTML = '';

            const currentPrompt = selectedReviewType === 'simple' ? simpleSystemPrompt : seoSystemPrompt;

            try {
                // Chama a API Gemini
                const resultText = await callGeminiAPI(userText, currentPrompt);
                displayResults(resultText);
            } catch (error) {
                console.error("Erro ao chamar a API:", error);
                showError("Ocorreu um erro ao processar sua solicitação. Verifique se sua chave de API está correta no código e tente novamente.");
            } finally {
                // Restaura a UI após a chamada
                reviewButton.disabled = false;
                loadingIndicator.classList.add('hidden');
            }
        }

        async function callGeminiAPI(userQuery, systemPrompt) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            const candidate = result.candidates?.[0];

            if (candidate && candidate.content?.parts?.[0]?.text) {
                return candidate.content.parts[0].text;
            } else {
                throw new Error("Resposta da API inválida ou sem conteúdo.");
            }
        }
        
        function displayResults(rawText) {
            // Converte a formatação básica (negrito, listas) para HTML
            let htmlContent = rawText
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>')
                .replace(/1️⃣/g, '<h2>1.')
                .replace(/2️⃣/g, '<h2>2.')
                .replace(/3️⃣/g, '<h2>3.')
                .replace(/4️⃣/g, '<h2>4.')
                .replace(/5️⃣/g, '<h2>5.');

            if (htmlContent.includes('<h2>1.')) {
                 htmlContent = htmlContent.replace(/<\/strong> Relatório \(erros e melhorias\)/, ' Relatório (Erros e Melhorias)</h2>')
                                      .replace(/<\/strong> Tabela lado a lado \(original × otimizado\)/, ' Tabela Lado a Lado (Original vs. Otimizado)</h2>')
                                      .replace(/<\/strong> Versão final do texto/, ' Versão Final do Texto</h2>')
                                      .replace(/<\/strong> Resumo numérico/, ' Resumo Numérico</h2>')
                                      .replace(/<\/strong> Observações SEO/, ' Observações SEO</h2>');
            } else {
                // Adiciona títulos H2 para as seções principais para melhor estilização (fallback for simple review)
                htmlContent = htmlContent.replace(/1\. <\/strong>Relatório detalhado de erros e correções<\/strong>/, '<h2>1. Relatório Detalhado de Erros e Correções</h2>');
                htmlContent = htmlContent.replace(/2\. <\/strong>Texto original \| Texto corrigido<\/strong>/, '<h2>2. Comparativo Lado a Lado</h2>');
                htmlContent = htmlContent.replace(/2\. <\/strong>Texto original \| Texto otimizado e revisado<\/strong>/, '<h2>2. Comparativo Lado a Lado</h2>');
                htmlContent = htmlContent.replace(/3\. <\/strong>Versão final do texto<\/strong>/, '<h2>3. Versão Final do Texto</h2>');
            }
            
            // Trata o resumo final
            const summaryIndex = htmlContent.lastIndexOf('<strong>Resumo das correções:');
            if (summaryIndex !== -1) {
                let summaryPart = htmlContent.substring(summaryIndex);
                summaryPart = summaryPart.replace(/<strong>Resumo das correções:<\/strong>/, '<h3>Resumo das Correções</h3>');
                htmlContent = htmlContent.substring(0, summaryIndex) + summaryPart;
            }
            
            // Tratamento especial para a tabela lado a lado
            let comparisonStartIndex = htmlContent.indexOf('<h2>2. Comparativo Lado a Lado</h2>');
            if (comparisonStartIndex === -1) {
                comparisonStartIndex = htmlContent.indexOf('<h2>2. Tabela Lado a Lado (Original vs. Otimizado)</h2>');
            }

            const finalVersionStartIndex = htmlContent.indexOf('<h2>3. Versão Final do Texto</h2>');

            if (comparisonStartIndex !== -1 && finalVersionStartIndex !== -1) {
                const comparisonSection = htmlContent.substring(comparisonStartIndex, finalVersionStartIndex);
                const originalTextMarker = '<strong>Texto original</strong>';
                
                let correctedTextMarker = '<strong>Texto corrigido</strong>';
                if (comparisonSection.indexOf(correctedTextMarker) === -1) {
                    correctedTextMarker = '<strong>Texto otimizado e revisado</strong>';
                }
                 if (comparisonSection.indexOf(correctedTextMarker) === -1) {
                    correctedTextMarker = '<strong>Texto revisado/otimizado</strong>';
                }


                const originalTextStart = comparisonSection.indexOf(originalTextMarker) + originalTextMarker.length;
                const correctedTextStart = comparisonSection.indexOf(correctedTextMarker);
                
                if(originalTextStart > -1 && correctedTextStart > -1) {
                    const originalText = comparisonSection.substring(originalTextStart, correctedTextStart).trim();
                    const correctedText = comparisonSection.substring(correctedTextStart + correctedTextMarker.length).trim();
                    
                    const correctedColumnTitle = selectedReviewType === 'seo' ? 'Texto Otimizado e Revisado' : 'Texto Corrigido';

                    const tableHTML = `
                        <h2>2. Comparativo Lado a Lado</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                            <div class="border border-gray-700 p-4 rounded-md">
                                <h3 class="text-white mb-3">Texto Original</h3>
                                <p>${originalText}</p>
                            </div>
                            <div class="border border-gray-700 p-4 rounded-md">
                                <h3 class="text-white mb-3">${correctedColumnTitle}</h3>
                                <p>${correctedText}</p>
                            </div>
                        </div>
                    `;
                    
                    // Substitui a seção de comparação pelo grid formatado
                    htmlContent = htmlContent.substring(0, comparisonStartIndex) + tableHTML + htmlContent.substring(finalVersionStartIndex);
                }
            }
            
            resultsContainer.innerHTML = htmlContent;
        }

        function showError(message) {
            outputContainer.classList.remove('hidden');
            errorMessage.classList.remove('hidden');
            errorMessage.textContent = message;
            resultsContainer.innerHTML = '';
            loadingIndicator.classList.add('hidden');
        }

    </script>

</body>
</html>





