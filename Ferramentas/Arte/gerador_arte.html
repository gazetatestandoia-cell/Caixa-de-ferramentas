<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arte</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Biblioteca para transformar HTML em imagem -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Fontes: Inter para UI, Tinos para Título, Montserrat para Subtítulo -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Montserrat:ital,wght@1,400;1,700&family=Tinos:wght@700&display=swap" rel="stylesheet">
    <style>
        /* Adicionado para garantir que a aplicação preencha o modal */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        /* --- Estilos Template Padrão --- */
        #story-content .story-title {
            font-family: 'Tinos', 'Times New Roman', serif;
            font-weight: 700; /* Bold */
        }
        #story-content .story-subtitle {
            font-family: 'Montserrat', sans-serif;
            font-style: italic;
            font-weight: 400; /* Regular */
        }
        /* Cor azul foi removida dos estilos já que não será mais usada */
        
        /* --- Estilos Template HZ --- */
        #story-content-hz {
            background-color: #F1F1F1;
        }
        .bg-hz-pink { background-color: #EC005C; }
        #story-content-hz .story-title {
            font-family: 'Inter', sans-serif;
            font-weight: 900; /* Black */
            color: #333;
        }
        #story-content-hz .story-category {
            font-family: 'Inter', sans-serif;
            background-color: #A9D4E2;
            color: #003366;
            font-weight: 700;
        }
         #story-content-hz .story-cta {
            background-color: #F1F1F1;
            border: 2px solid #A9D4E2;
            color: #003366;
            font-family: 'Inter', sans-serif;
            font-weight: 700;
        }

        /* --- Estilos Gerais --- */
        .aspect-9-16 { aspect-ratio: 9 / 16; }
        [contenteditable="true"] {
            cursor: text;
            transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        [contenteditable="true"]:focus {
            outline: none;
            background-color: rgba(59, 130, 246, 0.1);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
            border-radius: 4px;
        }

        .truncate-4-lines {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
        }
    </style>
</head>
<body class="bg-gray-100 p-4">

    <div class="bg-white p-6 md:p-8 rounded-2xl shadow-2xl w-full h-full overflow-y-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
            <!-- Coluna de Controles -->
            <div class="flex flex-col justify-center">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">Arte</h1>
                <p class="text-gray-600 mb-6">Cole o link, edite os textos e a imagem, e crie sua arte.</p>

                <div class="space-y-4">
                    <div>
                        <label for="url-input" class="block text-sm font-medium text-gray-700 mb-1">Link da Reportagem</label>
                        <input type="url" id="url-input" placeholder="https://seusite.com.br/sua-materia" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>

                    <button id="generate-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-all duration-300 flex items-center justify-center space-x-2">
                        <svg id="button-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                        <span>Gerar Arte</span>
                        <div id="loading-spinner" class="hidden animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                    </button>
                    <p id="error-message" class="text-red-500 text-sm mt-2 hidden"></p>
                </div>
            </div>

            <!-- Coluna de Pré-visualização -->
            <div class="flex flex-col items-center">
                <h2 class="text-lg sm:text-xl font-bold text-gray-800 mb-4">Como vai ficar</h2>
                <div class="flex flex-col sm:flex-row items-center sm:items-start gap-4 w-full justify-center">
                    <div id="story-preview-container" class="w-full max-w-[300px] bg-gray-200 rounded-xl overflow-hidden shadow-lg">
                        
                        <!-- TEMPLATE PADRÃO -->
                        <div id="story-content" class="aspect-9-16 w-full flex flex-col bg-white text-black">
                            <div class="h-2/3 p-6 flex flex-col justify-between">
                                <div>
                                    <div class="flex justify-between items-start mb-4">
                                        <div contenteditable="true" class="story-category bg-black text-white text-xs font-bold uppercase px-2 py-1 rounded flex items-center justify-center">Editoria</div>
                                    </div>
                                    <h2 contenteditable="true" class="story-title truncate-4-lines text-2xl lg:text-3xl leading-tight pb-2">Título da reportagem aparece aqui com destaque</h2>
                                </div>
                                <div>
                                    <p contenteditable="true" class="story-subtitle truncate-4-lines text-sm mt-2 pb-2">Linha fina da reportagem, um texto um pouco menor para complementar o título.</p>
                                    <div class="story-cta flex items-center justify-center mt-4 text-blue-600 font-bold">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link-2"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg>
                                    </div>
                                </div>
                            </div>
                            <div class="h-1/3 bg-gray-300">
                                <img src="https://placehold.co/1080x640/e2e8f0/cccccc?text=Imagem+da+Mat%C3%A9ria" class="story-image w-full h-full object-cover" alt="Imagem da matéria">
                            </div>
                        </div>

                        <!-- TEMPLATE HZ -->
                        <div id="story-content-hz" class="aspect-9-16 w-full flex-col hidden">
                            <div class="h-1/2 bg-hz-pink p-4 flex flex-col justify-between">
                                <div class="flex justify-end">
                                    <svg class="logo" width="60" height="25" viewBox="0 0 128 42" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.881836 41.28V0.719971H11.5618V16.8H26.5618V0.719971H37.2418V41.28H26.5618V24.48H11.5618V41.28H0.881836Z" fill="white"></path><path d="M57.971 41.28V0.719971H70.811L80.891 25.08V0.719971H90.851V41.28H78.011L67.931 16.92V41.28H57.971Z" fill="white"></path><path d="M109.208 42C102.608 42 97.568 40.08 94.088 36.24C90.648 32.36 88.928 27.48 88.928 21.6C88.928 15.72 90.648 10.84 94.088 7C97.568 3.11997 102.608 1.19997 109.208 1.19997C115.808 1.19997 120.848 3.11997 124.328 7C127.848 10.84 129.608 15.72 129.608 21.6C129.608 27.48 127.848 32.36 124.328 36.24C120.848 40.08 115.808 42 109.208 42ZM109.208 34.32C112.528 34.32 115.128 33.16 117.008 30.84C118.928 28.48 119.888 25.32 119.888 21.6C119.888 17.88 118.928 14.72 117.008 12.12C115.128 9.47997 112.528 8.15997 109.208 8.15997C105.888 8.15997 103.288 9.47997 101.408 12.12C99.568 14.72 98.648 17.88 98.648 21.6C98.648 25.32 99.568 28.48 101.408 30.84C103.288 33.16 105.888 34.32 109.208 34.32Z" fill="white"></path></svg>
                                </div>
                                <div class="p-2 bg-white rounded-lg shadow-lg">
                                    <img src="https://placehold.co/1080x640/ec005c/ffffff?text=HZ" class="story-image w-full h-full object-cover rounded" alt="Imagem da matéria HZ">
                                </div>
                            </div>
                            <div class="h-1/2 p-6 flex flex-col justify-between">
                                <div>
                                    <div contenteditable="true" class="story-category text-sm font-bold uppercase px-3 py-1 rounded inline-block mb-4">Destinos</div>
                                    <h2 contenteditable="true" class="story-title truncate-4-lines text-3xl leading-tight pb-2">Título da reportagem de HZ entra aqui</h2>
                                </div>
                                <div contenteditable="true" class="story-cta flex items-center justify-center space-x-2 py-3 px-4 rounded-lg font-bold text-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link-2"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg>
                                    <span>LEIA.AG</span>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!-- Menu de Edição de Imagem -->
                    <div id="image-edit-controls" class="flex sm:flex-col space-x-2 sm:space-x-0 sm:space-y-2 hidden">
                         <button id="edit-image-pc-btn" title="Subir do computador" class="p-2 bg-gray-200 rounded-full hover:bg-blue-500 hover:text-white transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg></button>
                         <button id="edit-image-url-btn" title="Usar um link da web" class="p-2 bg-gray-200 rounded-full hover:bg-blue-500 hover:text-white transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7-7l-1.72 1.72"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7 7l1.72-1.72"></path></svg></button>
                         <button id="edit-image-delete-btn" title="Remover imagem" class="p-2 bg-gray-200 rounded-full hover:bg-red-500 hover:text-white transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg></button>
                    </div>
                </div>

                <!-- Input de URL (inicialmente oculto) -->
                <div id="image-url-container" class="w-full max-w-[300px] mt-2 hidden">
                    <input type="url" id="image-url-input" placeholder="Cole o endereço da imagem" class="w-full text-sm p-2 border rounded-md">
                    <button id="image-url-submit" class="w-full bg-green-500 text-white text-sm mt-1 p-2 rounded-md hover:bg-green-600">Confirmar</button>
                </div>

                <input type="file" id="image-upload-input" class="hidden" accept="image/*">
                
                <div id="download-area" class="mt-4 text-center hidden">
                    <button id="download-btn" class="bg-green-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-600 transition-all duration-300 inline-block">
                        Baixar Imagem (JPEG)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Elementos do DOM ---
        const urlInput = document.getElementById('url-input');
        const generateBtn = document.getElementById('generate-btn');
        const buttonIcon = document.getElementById('button-icon');
        const loadingSpinner = document.getElementById('loading-spinner');
        const errorMessage = document.getElementById('error-message');
        
        const defaultTemplate = document.getElementById('story-content');
        const hzTemplate = document.getElementById('story-content-hz');
        let activeTemplate = defaultTemplate; // Define o template padrão como inicial

        const downloadArea = document.getElementById('download-area');
        const downloadBtn = document.getElementById('download-btn');
        
        // Elementos de edição de imagem
        const imageEditControls = document.getElementById('image-edit-controls');
        const editImagePcBtn = document.getElementById('edit-image-pc-btn');
        const editImageUrlBtn = document.getElementById('edit-image-url-btn');
        const editImageDeleteBtn = document.getElementById('edit-image-delete-btn');
        const imageUploadInput = document.getElementById('image-upload-input');
        const imageUrlContainer = document.getElementById('image-url-container');
        const imageUrlInput = document.getElementById('image-url-input');
        const imageUrlSubmit = document.getElementById('image-url-submit');

        // --- Funções ---

        async function fetchArticleData(url) {
            // Usando um proxy CORS mais confiável
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error(`Falha ao buscar URL. Status: ${response.status}`);
                const htmlContent = await response.text();
                if (!htmlContent) throw new Error('Não foi possível obter o conteúdo HTML da URL fornecida.');

                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlContent, 'text/html');
                const getMetaContent = (prop) => doc.querySelector(`meta[property='${prop}'], meta[name='${prop}']`)?.getAttribute('content');

                const title = getMetaContent('og:title') || doc.querySelector('title')?.textContent || 'Título não encontrado';
                const subtitle = getMetaContent('og:description') || getMetaContent('description') || 'Subtítulo não encontrado';
                const imageUrl = getMetaContent('og:image') || 'https://placehold.co/1080x960/e2e8f0/cccccc?text=Imagem+n%C3%A3o+encontrada';
                const category = getMetaContent('og:site_name') || getMetaContent('article:section') || 'Notícias';

                return { title, subtitle, imageUrl, category };
            } catch (error) {
                console.error('Erro ao buscar ou analisar os dados do artigo:', error);
                throw new Error('Não foi possível buscar os dados. Verifique o link ou a página pode estar indisponível.');
            }
        }

        // --- Event Listeners ---
        generateBtn.addEventListener('click', async () => {
            const url = urlInput.value;
            if (!url) {
                errorMessage.textContent = 'Por favor, insira um link válido.';
                errorMessage.classList.remove('hidden');
                return;
            }

            // --- Lógica de Seleção de Template ---
            if (url.includes('https://www.agazeta.com.br/hz')) {
                activeTemplate = hzTemplate;
                defaultTemplate.classList.add('hidden');
                hzTemplate.classList.remove('hidden');
                hzTemplate.classList.add('flex');
            } else {
                activeTemplate = defaultTemplate;
                hzTemplate.classList.add('hidden');
                hzTemplate.classList.remove('flex');
                defaultTemplate.classList.remove('hidden');
            }
            
            const storyImage = activeTemplate.querySelector('.story-image');

            errorMessage.classList.add('hidden');
            downloadArea.classList.add('hidden');
            imageEditControls.classList.add('hidden');
            generateBtn.disabled = true;
            buttonIcon.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            storyImage.src = "https://placehold.co/1080x960/e2e8f0/cccccc?text=Carregando...";

            try {
                const data = await fetchArticleData(url);
                
                activeTemplate.querySelector('.story-title').textContent = data.title;
                 // HZ não tem subtítulo no layout, então só preenchemos se for o template padrão
                if (activeTemplate === defaultTemplate) {
                    activeTemplate.querySelector('.story-subtitle').textContent = data.subtitle;
                }
                activeTemplate.querySelector('.story-category').textContent = data.category;

                storyImage.onload = () => {
                    downloadArea.classList.remove('hidden');
                    imageEditControls.classList.remove('hidden');
                    generateBtn.disabled = false;
                    buttonIcon.classList.remove('hidden');
                    loadingSpinner.classList.add('hidden');
                };
                storyImage.onerror = () => {
                    errorMessage.textContent = 'Não foi possível carregar a imagem da matéria.';
                    errorMessage.classList.remove('hidden');
                    generateBtn.disabled = false;
                    buttonIcon.classList.remove('hidden');
                    loadingSpinner.classList.add('hidden');
                    storyImage.src = "https://placehold.co/1080x960/f87171/ffffff?text=Erro+ao+carregar";
                    imageEditControls.classList.remove('hidden');
                }
                
                storyImage.crossOrigin = "anonymous"; 
                storyImage.src = data.imageUrl;

            } catch (error) {
                errorMessage.textContent = error.message;
                errorMessage.classList.remove('hidden');
                generateBtn.disabled = false;
                buttonIcon.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
            }
        });
        
        downloadBtn.addEventListener('click', async () => {
            if (document.activeElement) document.activeElement.blur();
            const originalText = downloadBtn.textContent;
            downloadBtn.textContent = 'Baixando...';
            downloadBtn.disabled = true;

            try {
                await new Promise(resolve => setTimeout(resolve, 100));
                const canvas = await html2canvas(activeTemplate, { useCORS: true, scale: 2 });
                const imageURL = canvas.toDataURL('image/jpeg', 0.9);
                const tempLink = document.createElement('a');
                tempLink.href = imageURL;
                tempLink.download = 'story-gerado.jpeg';
                document.body.appendChild(tempLink);
                tempLink.click();
                document.body.removeChild(tempLink);
            } catch (err) {
                console.error("Erro ao gerar a imagem:", err);
                alert("Ocorreu um erro ao gerar a imagem.");
            } finally {
                downloadBtn.textContent = originalText;
                downloadBtn.disabled = false;
            }
        });

        // --- Event Listeners para Edição de Imagem ---
        function getActiveImage() {
            return activeTemplate.querySelector('.story-image');
        }

        editImagePcBtn.addEventListener('click', () => imageUploadInput.click());

        imageUploadInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => getActiveImage().src = e.target.result;
                reader.readAsDataURL(file);
            }
        });

        editImageUrlBtn.addEventListener('click', () => imageUrlContainer.classList.toggle('hidden'));

        imageUrlSubmit.addEventListener('click', () => {
            const newUrl = imageUrlInput.value.trim();
            if (newUrl) {
                const activeImage = getActiveImage();
                activeImage.crossOrigin = "anonymous";
                activeImage.src = newUrl;
                imageUrlInput.value = '';
                imageUrlContainer.classList.add('hidden');
            }
        });

        editImageDeleteBtn.addEventListener('click', () => {
            getActiveImage().src = 'https://placehold.co/1080x640/e2e8f0/cccccc?text=Imagem+Removida';
        });
    </script>
</body>
</html>
